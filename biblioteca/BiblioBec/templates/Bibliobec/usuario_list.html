{% load static %}
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/all.min.css' %}" />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <link rel="stylesheet" href="{% static 'css/documento.css' %}" />
    <link rel="icon" type="image/x-icon" href="{% static 'img/icono.png' %}" />
    <link rel="stylesheet" type="text/css" href="slick-1.8.1/slick/slick.css"/> 
    <link rel="stylesheet" type="text/css" href="slick-1.8.1/slick/slick-theme.css"/>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/all.min.js' %}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src='//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js'></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script src="{% static 'js/utils.js' %}"></script>
    <title>Usuarios</title> 
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <div class="container-fluid">
            <a class="navbar-brand" href="{% url 'index' %}">
              {% load static %}
              <img class="img-fluid" src="{% static 'img/logo.png' %}" width="150"
              height="80"
              alt="logo">
            </a>
            <button
              class="navbar-toggler"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
              <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="{% url 'index' %}">Inicio</a>
                </li>
                
                <li class="nav-item dropdown">
                  <a
                    class="nav-link dropdown-toggle"
                    href="#"
                    id="navbarDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    Catálogo
                  </a>
                  <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><a class="dropdown-item" href="{% url 'catalogo' %}">Mostrar todo</a></li>
                    <li><a class="dropdown-item" href="{% url 'catalogo_libros' %}">Libros</a></li>
                    <li><a class="dropdown-item" href="{% url 'catalogo_audio' %}">Audios</a></li>
                    <li><a class="dropdown-item" href="{% url 'catalogo_videos' %}">Videos</a></li>
                  </ul>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'solicitudes' %}">Solicitudes</a>
                </li>
                {% if request.session.user_login.user.tipo == 1 or request.session.user_login.user.tipo == 2 %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'usuario_list' %}">Usuarios</a>
                  </li>
                {% endif %}
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'ayuda' %}">Ayuda en línea</a>
                </li>
              </ul>
              <div class="me-3">
                <form class="d-flex" method="POST" action="catalogo">
                  {%csrf_token%}
                  <input
                    class="form-control me-2"
                    type="search"
                    placeholder="Buscar documento"
                    name="titulo"
                  />
                  <button class="btn btn-maincolor" type="submit">
                    <i class="fas fa-search"></i>
                  </button>
                </form>
              </div>
            </div>
            {% if request.session.user_login %}
              <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                  <div class="row ">
                    <div class="col-md-2">
                      <img class="rounded-circle mt-2 me-2" src="data:imagen/png;base64, {{request.session.user_login.user.foto}}" width="43" height="43">
                    </div>
                  <div class="col-md-7 text-center">
                    <h6 class="ms-1" style="color: #0c3a6d; font-size: 16px;">{{ request.session.user_login.user.nombre }} {{ request.session.user_login.user.apellido }}</h6>
                    <h6 class="ms-1" style="color: #0c3a6d; font-size: 15px; ">{{ request.session.user_login.user.tipo_desc }}</h6>
                  </div>
                  <div class="col-md-2">
                    <a class="btn me-1 mt-1" style="color: black; background-color: #f8f9fa;" href="{% url 'logout' %}">  <i class="fas fa-sign-out-alt"></i> </a> 
                  </div>
                  </div>
                </li>
              </ul>
              {% else %}
                <a class="btn btn-primary1 me-3" href="{% url 'login' %}"> Ingresar </a>  
            {% endif %}
          </div>
        </nav>
    </header>
{% block js %}
  <script>
    function eliminarUsuario(rut_usr) {
      Swal.fire({
        "title":"¿Está seguro que desea eliminar el usuario?",
        "icon":"question",
        "showCancelButton":true,
        "cancelButtonText":"Cancelar",
        "confirmButtonText":"Eliminar",
        "reverseButtons":true,
        "confirmButtonColor":"red"
      })
      .then(function(result) {
        if (result.isConfirmed){
          window.location.href = "usuario/delete?rut_usr="+rut_usr
        }
      })
    }
  </script>
{% endblock %}

{% block content %}

<br>
<div class="masthead container d-flex flex-column" style="max-width: 1140px;">
  <h2 class="text-center text-uppercase">Usuarios</h2>

  <div class="row">
    <div class="col-md-9">
    <form class="d-flex" method="POST" action="usuarios">
      {%csrf_token%}
      <input
        class="form-control me-2"
        type="search"
        placeholder="Buscar usuario"
        name="rut_usr"
        maxlength="9"
        oninput="checkRut(this)"
      />
      <button class="btn btn-maincolor" type="submit">
        <i class="fas fa-search"></i>
      </button>
    </form>
  </div>
  {% if request.session.user_login.user.tipo == 1 %}
    <div class="col-md-3">
      <a class="btn btn-primary1" href="{% url 'usuario_create' %}" 
      style="float: right; font-size: 14px;">Registrar usuario</a>
    </div>
  {% endif %}
  </div>
</div>
  <br>
<div class="row">

  {% if page_obj %}
    {% for u in page_obj %}
      <div class="col-md-1"></div>
        <div class="col-md-10">
          <div class="card mb-3" >
            <div class="row g-0">
              <div class="col-md-2">
                {% if u.foto %}
                <img class="rounded-circle mt-4 ms-3" width="200" height="200" src="data:imagen/png;base64, {{u.foto}}" data-holder-rendered="true">
                {% endif %}
              </div>
              <div class="col-md-10">
                <div class="card-body pb-0">
                  <h5 class="card-title ms-1" style="color: #1796c0; font-size: 25px; font-weight: bold;">{{ u.data.1 }} {{u.data.2}} {{u.data.3}}</h5>
                  <div class="row">
                    <div class="col-md-6">
                      <p class="card-text ms-2">Rut: {{u.data.0}}</p>
                      <p class="card-text ms-2">Teléfono: {{u.data.5}}</p>
                      <p class="card-text ms-2">Correo electrónico: {{u.data.6}}</p>
                      <p class="card-text ms-2">Dirección: {{u.data.4}}</p>
                    </div>
                    <div class="col-md-4">
                      <p class="card-text">Tipo usuario: {{u.data.14.title}}</p>
                      {% if u.huella %}
                        <p class="card-text">Huella:    </p>
                        <img class="mb-3" src="data:imagen/png;base64, {{u.huella}}" width="130" height="130">
                      {% endif %}
                    </div>
                    {% if request.session.user_login.user.tipo == 1 %}
                      <div class="col-md-2">
                        <a class="btn btn-celeste mt-5" href="usuario/update?rut_usr={{ u.data.0 }}" >Editar <i class="fas fa-user-edit"></i></a>
                        <br>
                        <a class="btn btn-danger mt-2 mb-5" onclick="eliminarUsuario('{{u.data.0}}')">Eliminar <i class="fas fa-trash"></i></a>
                      </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      <div class="col-md-1"></div>
    {% endfor %}
  {% endif %}
</div>
<div class="row mb-3">
  <ul class="pagination justify-content-center">
    {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a></li>
    {% else %}
      <li class="page-item disabled"><span class="page-link">&laquo;</span></li>
    {% endif %}

    {% for i in page_obj.paginator.page_range %}
      {% if page_obj.number == i %}
        <li class="page-item active"><span class="page-link">{{ i }} <span class="sr-only">(current)</span></span></li>
      {% else %}
        <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a></li>
    {% else %}
      <li class="disabled page-item"><span class="page-link">&raquo;</span></li>
    {% endif %}
    </ul>
  </div>          
{% endblock %}

{% if messages %}
  {%for m in messages%}
    <script>
      const Alert = "{{m}}";
      const mensaje = Alert.split("/")
      Swal.fire({
      "text": mensaje[0],
      "icon": mensaje[1]
      })
    </script>
  {% endfor %}
{% endif %}